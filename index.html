<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a3c34">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="إدارة المشتركين">
    <meta name="description" content="تطبيق إدارة مشتركي الإنترنت - يعمل بدون إنترنت">
    <meta name="keywords" content="مشتركين, إنترنت, إدارة, عمل محلي">
    <title>إدارة مشتركي الإنترنت - عمل محلي</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        :root {
            --primary-color: #1a3c34;
            --secondary-color: #2a5c50;
            --accent-color: #34a892;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --border-radius: 12px;
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f0f4f7 0%, #e0e8f0 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            font-size: 16px;
            overflow-x: hidden;
        }

        /* باقي الـ CSS كما هو في الكود الأصلي */
        /* يمكنك نسخ أنماط CSS من الكود الأصلي هنا بدون تغيير */
        /* لتجنب التكرار، لم أضف الأنماط الكاملة هنا، لكن يجب أن تكون مطابقة للكود الأصلي */
    </style>
</head>
<body>
    <div id="splash-screen">
        <div class="splash-logo">📱</div>
        <div class="splash-text">إدارة مشتركي الإنترنت</div>
        <div class="splash-loader"></div>
    </div>

    <div class="app-container">
        <!-- باقي محتوى HTML كما هو في الكود الأصلي -->
        <!-- يمكنك نسخ محتوى الـ <div class="app-container"> وما بداخله من الكود الأصلي -->
    </div>

    <div id="notification" class="notification">
        <span>🔔</span>
        <span id="notificationText"></span>
    </div>

    <script>
        // تعريف متغيرات التطبيق
        let subscribers = JSON.parse(localStorage.getItem('subscribers')) || [];
        let currentCurrency = localStorage.getItem('currency') || 'SAR';
        let currentPage = 1;
        const itemsPerPage = 5;
        let deferredPrompt;

        // تهيئة التطبيق
        function initApp() {
            setTimeout(() => {
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash-screen').style.display = 'none';
                    document.querySelector('.app-container').style.display = 'block';
                }, 500);
            }, 1500);

            document.getElementById('startDate').valueAsDate = new Date();
            document.getElementById('currency').value = currentCurrency;
            updateCurrencySymbol();
            displaySubscribers();

            const overdueSubscribers = subscribers.filter(subscriber => {
                const remainingDays = calculateRemainingDays(subscriber.startDate, subscriber.subscriptionDays);
                return remainingDays <= 0;
            });

            if (overdueSubscribers.length > 0) {
                showNotification(`لديك ${overdueSubscribers.length} اشتراك منتهٍ يحتاج إلى تجديد`, 'warning');
            }

            // تسجيل Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            }

            // إظهار موجه التثبيت
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                const installPrompt = document.getElementById('installPrompt');
                installPrompt.style.display = 'flex';

                document.getElementById('installButton').addEventListener('click', () => {
                    installPrompt.style.display = 'none';
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        } else {
                            console.log('User dismissed the install prompt');
                        }
                        deferredPrompt = null;
                    });
                });
            });

            // التحقق من حالة الاتصال
            window.addEventListener('online', () => {
                showNotification('تم الاتصال بالإنترنت', 'success');
            });
            window.addEventListener('offline', () => {
                showNotification('أنت في وضع عدم الاتصال', 'warning');
            });
        }

        // باقي الدوال (updateDateTime, showNotification, إلخ) كما هي في الكود الأصلي
        // يمكنك نسخ الدوال من الكود الأصلي هنا بدون تغيير

        // تشغيل التطبيق
        window.onload = function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            initApp();
        };
    </script>
</body>
</html>